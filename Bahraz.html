<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Bahraz Casino</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --bg-primary: #121212;
            --bg-secondary: #1e1e1e;
            --bg-tertiary: #2d2d2d;
            --text-primary: #ffffff;
            --text-secondary: #b3b3b3;
            --accent: #bb86fc;
            --accent-secondary: #03dac6;
            --danger: #cf6679;
            --success: #4caf50;
            --rarity-common: #727272;
            --rarity-rare: #558bcc;
            --rarity-epic: #ab47bc;
            --rarity-legendary: #f9a825;
            --rarity-mythical: #e53935;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Roboto', sans-serif;
        }

        body {
            background-color: var(--bg-primary);
            color: var(--text-primary);
            height: 100vh;
            overflow: hidden;
            position: relative;
        }

        .app-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            max-width: 100%;
            margin: 0 auto;
            position: relative;
        }

        .content-area {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
            padding-bottom: 70px;
        }

        /* Навигационная панель */
        .nav-tabs {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            display: flex;
            background-color: var(--bg-secondary);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            z-index: 100;
        }

        .nav-tab {
            flex: 1;
            text-align: center;
            padding: 12px 0;
            cursor: pointer;
            transition: background-color 0.3s;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .nav-tab.active {
            color: var(--accent);
        }

        .nav-tab i {
            font-size: 20px;
            margin-bottom: 4px;
        }

        .nav-tab span {
            font-size: 12px;
        }

        /* Стили для вкладок */
        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Стили для магазина */
        .shop-items {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            margin-top: 20px;
        }

        .shop-item {
            background-color: var(--bg-tertiary);
            border-radius: 16px;
            padding: 20px;
            text-align: center;
            transition: transform 0.2s, box-shadow 0.2s;
            position: relative;
            overflow: hidden;
        }

        .shop-item:active {
            transform: scale(0.97);
        }

        .shop-item-image {
            width: 80px;
            height: 80px;
            margin: 0 auto 16px;
            font-size: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.3s;
        }

        .shop-item:hover .shop-item-image {
            transform: scale(1.1);
        }

        .shop-item-name {
            font-weight: 500;
            margin-bottom: 8px;
            font-size: 16px;
        }

        .shop-item-description {
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 12px;
            min-height: 32px;
        }

        .shop-item-price {
            color: var(--accent);
            margin-bottom: 16px;
            font-size: 18px;
            font-weight: 500;
        }

        .buy-btn {
            background: linear-gradient(45deg, var(--accent), var(--accent-secondary));
            color: white;
            border: none;
            padding: 10px 0;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            width: 100%;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .buy-btn:active {
            transform: scale(0.95);
        }

        /* Стили для инвентаря */
        .inventory-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 20px 0;
        }

        .combine-btn {
            background: linear-gradient(45deg, var(--accent), var(--accent-secondary));
            color: white;
            border: none;
            padding: 10px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .inventory-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
        }

        .inventory-item {
            background-color: var(--bg-tertiary);
            border-radius: 12px;
            overflow: hidden;
            position: relative;
            aspect-ratio: 1/1;
            transition: transform 0.2s;
        }

        .inventory-item:active {
            transform: scale(0.95);
        }

        .inventory-item.selected {
            box-shadow: 0 0 0 3px var(--accent);
        }

        .item-image {
            width: 100%;
            height: 70%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
        }

        .item-info {
            padding: 8px;
            font-size: 12px;
            background: rgba(0, 0, 0, 0.4);
        }

        .item-name {
            font-weight: 500;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .item-rarity {
            font-size: 10px;
            opacity: 0.8;
        }

        .sell-btn {
            position: absolute;
            bottom: 5px;
            right: 5px;
            background: var(--danger);
            color: white;
            border: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            opacity: 0.8;
        }

        /* Стили для профиля */
        .profile-header {
            display: flex;
            align-items: center;
            margin-bottom: 24px;
        }

        .profile-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(45deg, var(--accent), var(--accent-secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            margin-right: 16px;
            color: white;
        }

        .profile-info {
            flex: 1;
        }

        .profile-name {
            font-size: 20px;
            font-weight: 500;
            margin-bottom: 4px;
        }

        .profile-balance {
            color: var(--accent);
            font-size: 18px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .profile-balance i {
            font-size: 20px;
        }

        .stats-section {
            background-color: var(--bg-secondary);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 24px;
        }

        .section-title {
            font-size: 18px;
            font-weight: 500;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
            padding-bottom: 12px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .stat-item:last-child {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
        }

        .promo-section {
            background-color: var(--bg-secondary);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 24px;
        }

        .promo-input {
            display: flex;
            margin-bottom: 16px;
        }

        .promo-input input {
            flex: 1;
            background-color: var(--bg-tertiary);
            border: none;
            border-radius: 12px 0 0 12px;
            padding: 12px 16px;
            color: var(--text-primary);
            outline: none;
        }

        .promo-input button {
            background: linear-gradient(45deg, var(--accent), var(--accent-secondary));
            color: white;
            border: none;
            border-radius: 0 12px 12px 0;
            padding: 0 20px;
            cursor: pointer;
            font-weight: 500;
        }

        .subscribe-section {
            background-color: var(--bg-secondary);
            border-radius: 16px;
            padding: 20px;
            text-align: center;
        }

        .subscribe-btn {
            background: linear-gradient(45deg, var(--accent), var(--accent-secondary));
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 20px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            margin-top: 16px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        /* Стили для мини-игр */
        .minigames-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            margin-top: 20px;
        }

        .minigame-item {
            background-color: var(--bg-tertiary);
            border-radius: 16px;
            padding: 20px;
            text-align: center;
            transition: transform 0.2s;
        }

        .minigame-item:active {
            transform: scale(0.97);
        }

        .minigame-icon {
            font-size: 40px;
            margin-bottom: 16px;
        }

        .minigame-name {
            font-weight: 500;
            margin-bottom: 8px;
        }

        .minigame-reward {
            color: var(--accent);
            margin-bottom: 16px;
        }

        .play-btn {
            background: linear-gradient(45deg, var(--accent), var(--accent-secondary));
            color: white;
            border: none;
            padding: 10px 0;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            width: 100%;
        }

        /* Игра "2048" */
        .game-2048-container {
            margin-top: 20px;
        }

        .game-2048-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .game-2048-score {
            font-size: 18px;
            font-weight: 500;
        }

        .game-2048-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            grid-template-rows: repeat(4, 1fr);
            gap: 8px;
            background-color: var(--bg-secondary);
            padding: 8px;
            border-radius: 8px;
            margin-bottom: 16px;
            aspect-ratio: 1/1;
        }

        .game-2048-cell {
            background-color: var(--bg-tertiary);
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: bold;
        }

        .game-2048-controls {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(3, 1fr);
            gap: 8px;
            margin-top: 16px;
        }

        .game-control-btn {
            background: var(--bg-tertiary);
            border: none;
            border-radius: 8px;
            color: white;
            font-size: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            aspect-ratio: 1/1;
        }

        .game-control-btn:active {
            background: var(--accent);
        }

        /* Игра "Пазл" */
        .puzzle-container {
            margin-top: 20px;
        }

        .puzzle-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(3, 1fr);
            gap: 4px;
            background-color: var(--bg-secondary);
            padding: 4px;
            border-radius: 8px;
            margin-bottom: 16px;
            aspect-ratio: 1/1;
        }

        .puzzle-piece {
            background-color: var(--accent);
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
        }

        .puzzle-piece.empty {
            background-color: transparent;
        }

        /* Анимация рулетки */
        .roulette-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.9);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
        }

        .roulette-overlay.active {
            opacity: 1;
            pointer-events: all;
        }

        .roulette-container {
            width: 300px;
            height: 400px;
            position: relative;
            overflow: hidden;
            border-radius: 16px;
            background-color: var(--bg-secondary);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }

        .roulette-items {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            transition: top 5s cubic-bezier(0.17, 0.67, 0.21, 0.99);
        }

        .roulette-item {
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .roulette-center {
            position: absolute;
            left: 0;
            right: 0;
            top: 50%;
            height: 4px;
            background: linear-gradient(90deg, transparent, var(--accent), transparent);
            transform: translateY(-50%);
        }

        .roulette-close {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.5);
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-size: 20px;
            cursor: pointer;
            z-index: 1001;
        }

        /* Модальное окно приза */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
        }

        .modal-overlay.active {
            opacity: 1;
            pointer-events: all;
        }

        .modal-content {
            background-color: var(--bg-secondary);
            border-radius: 20px;
            padding: 24px;
            width: 90%;
            max-width: 400px;
            text-align: center;
            transform: scale(0.9);
            transition: transform 0.3s;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }

        .modal-overlay.active .modal-content {
            transform: scale(1);
        }

        .modal-prize {
            font-size: 64px;
            margin: 20px 0;
            animation: pulse 1s infinite alternate;
        }

        @keyframes pulse {
            from { transform: scale(1); }
            to { transform: scale(1.1); }
        }

        .modal-title {
            font-size: 24px;
            margin-bottom: 12px;
            font-weight: 500;
        }

        .modal-rarity {
            font-size: 16px;
            margin-bottom: 20px;
            padding: 6px 16px;
            border-radius: 20px;
            display: inline-block;
            font-weight: 500;
        }

        .modal-price {
            margin-bottom: 24px;
            font-size: 18px;
        }

        .modal-actions {
            display: flex;
            gap: 12px;
        }

        .modal-btn {
            flex: 1;
            padding: 12px;
            border-radius: 12px;
            border: none;
            font-weight: 500;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .modal-btn:active {
            transform: scale(0.95);
        }

        .modal-btn-sell {
            background: linear-gradient(45deg, #ff4b4b, #d30000);
            color: white;
        }

        .modal-btn-close {
            background: linear-gradient(45deg, var(--bg-tertiary), #3d3d3d);
            color: var(--text-primary);
        }

        /* Кнопка покупки звезд */
        .buy-stars-btn {
            background: linear-gradient(45deg, #ff6b00, #ffa500);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 20px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            margin-top: 16px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        /* Анимации */
        @keyframes celebrate {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        .celebrate {
            animation: celebrate 0.5s ease-in-out;
        }

        /* Улучшенные стили для редкостей */
        .common { color: var(--rarity-common); background-color: rgba(114, 114, 114, 0.2); }
        .rare { color: var(--rarity-rare); background-color: rgba(85, 139, 204, 0.2); }
        .epic { color: var(--rarity-epic); background-color: rgba(171, 71, 188, 0.2); }
        .legendary { color: var(--rarity-legendary); background-color: rgba(249, 168, 37, 0.2); }
        .mythical { color: var(--rarity-mythical); background-color: rgba(229, 57, 53, 0.2); }

        /* Адаптивность */
        @media (max-width: 360px) {
            .shop-items, .minigames-grid {
                grid-template-columns: 1fr;
            }
            
            .inventory-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .profile-header {
                flex-direction: column;
                text-align: center;
            }
            
            .profile-avatar {
                margin-right: 0;
                margin-bottom: 16px;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <div class="content-area">
            <!-- Вкладка магазина -->
            <div id="shop-tab" class="tab-content active">
                <h2>Магазин Дропов</h2>
                <p style="color: var(--text-secondary); margin-bottom: 20px;">Приобретайте дропы и получайте уникальные призы</p>
                <div class="shop-items">
                    <div class="shop-item">
                        <div class="shop-item-image">📦</div>
                        <div class="shop-item-name">Обычный дроп</div>
                        <div class="shop-item-description">Шанс на обычные и редкие призы</div>
                        <div class="shop-item-price">100 монет</div>
                        <button class="buy-btn" data-type="common">Купить и открыть</button>
                    </div>
                    <div class="shop-item">
                        <div class="shop-item-image" style="font-size: 45px;">📦</div>
                        <div class="shop-item-name">Редкий дроп</div>
                        <div class="shop-item-description">Шанс на редкие и эпические призы</div>
                        <div class="shop-item-price">250 монет</div>
                        <button class="buy-btn" data-type="rare">Купить и открыть</button>
                    </div>
                    <div class="shop-item">
                        <div class="shop-item-image" style="font-size: 40px;">📦</div>
                        <div class="shop-item-name">Эпический дроп</div>
                        <div class="shop-item-description">Шанс на эпические и легендарные призы</div>
                        <div class="shop-item-price">500 монет</div>
                        <button class="buy-btn" data-type="epic">Купить и открыть</button>
                    </div>
                    <div class="shop-item">
                        <div class="shop-item-image" style="font-size: 35px;">📦</div>
                        <div class="shop-item-name">Легендарный дроп</div>
                        <div class="shop-item-description">Шанс на легендарные и мифические призы</div>
                        <div class="shop-item-price">1000 монет</div>
                        <button class="buy-btn" data-type="legendary">Купить и открыть</button>
                    </div>
                    <div class="shop-item">
                        <div class="shop-item-image" style="font-size: 30px;">📦</div>
                        <div class="shop-item-name">Мифический дроп</div>
                        <div class="shop-item-description">Высокий шанс на мифические призы</div>
                        <div class="shop-item-price">2000 монет</div>
                        <button class="buy-btn" data-type="mythical">Купить и открыть</button>
                    </div>
                </div>

                <div style="text-align: center; margin-top: 30px;">
                    <button class="buy-stars-btn" id="buy-stars-btn">
                        <i>⭐</i> Купить 1,000,000 монет за 1 звезду
                    </button>
                </div>
            </div>

            <!-- Вкладка инвентаря -->
            <div id="inventory-tab" class="tab-content">
                <h2>Инвентарь</h2>
                <div class="inventory-header">
                    <p style="color: var(--text-secondary);">Ваши полученные призы: <span id="inventory-count">0</span></p>
                    <button class="combine-btn" id="combine-btn">
                        <i>🔄</i> Объединить
                    </button>
                </div>
                <div class="inventory-grid" id="inventory-grid">
                    <!-- Элементы инвентаря будут добавляться здесь -->
                </div>
            </div>

            <!-- Вкладка мини-игр -->
            <div id="minigames-tab" class="tab-content">
                <h2>Мини-игры</h2>
                <p style="color: var(--text-secondary); margin-bottom: 20px;">Играйте и зарабатывайте монеты</p>
                
                <div class="minigames-grid">
                    <div class="minigame-item" data-game="2048">
                        <div class="minigame-icon">🧩</div>
                        <div class="minigame-name">2048</div>
                        <div class="minigame-reward">До 500 монет</div>
                        <button class="play-btn" data-game="2048">Играть</button>
                    </div>
                    <div class="minigame-item" data-game="puzzle">
                        <div class="minigame-icon">🔀</div>
                        <div class="minigame-name">Пазл</div>
                        <div class="minigame-reward">До 300 монет</div>
                        <button class="play-btn" data-game="puzzle">Играть</button>
                    </div>
                </div>

                <!-- Игра 2048 -->
                <div id="game-2048" class="game-2048-container" style="display: none;">
                    <div class="game-2048-header">
                        <div class="game-2048-score">Счет: <span id="2048-score">0</span></div>
                        <button class="combine-btn" id="2048-back">
                            <i>←</i> Назад
                        </button>
                    </div>
                    <div class="game-2048-grid" id="2048-grid">
                        <!-- Игровое поле 2048 -->
                    </div>
                    <div class="game-2048-controls">
                        <div></div>
                        <button class="game-control-btn" id="2048-up">↑</button>
                        <div></div>
                        <button class="game-control-btn" id="2048-left">←</button>
                        <div></div>
                        <button class="game-control-btn" id="2048-right">→</button>
                        <div></div>
                        <button class="game-control-btn" id="2048-down">↓</button>
                        <div></div>
                    </div>
                </div>

                <!-- Игра Пазл -->
                <div id="game-puzzle" class="puzzle-container" style="display: none;">
                    <div class="game-2048-header">
                        <div>Ходы: <span id="puzzle-moves">0</span></div>
                        <button class="combine-btn" id="puzzle-back">
                            <i>←</i> Назад
                        </button>
                    </div>
                    <div class="puzzle-grid" id="puzzle-grid">
                        <!-- Игровое поле пазла -->
                    </div>
                </div>
            </div>

            <!-- Вкладка профиля -->
            <div id="profile-tab" class="tab-content">
                <div class="profile-header">
                    <div class="profile-avatar" id="user-avatar">U</div>
                    <div class="profile-info">
                        <div class="profile-name" id="user-name">Пользователь</div>
                        <div class="profile-balance">
                            <i>💰</i> <span id="user-balance">1000</span> монет
                        </div>
                    </div>
                </div>

                <div class="stats-section">
                    <div class="section-title">
                        <i>📊</i> Статистика
                    </div>
                    <div class="stat-item">
                        <span>Открыто дропов:</span>
                        <span id="stats-opened">0</span>
                    </div>
                    <div class="stat-item">
                        <span>Всего призов:</span>
                        <span id="stats-total">0</span>
                    </div>
                    <div class="stat-item">
                        <span>Самый редкий приз:</span>
                        <span id="stats-rarest">Нет</span>
                    </div>
                    <div class="stat-item">
                        <span>Продано призов:</span>
                        <span id="stats-sold">0</span>
                    </div>
                </div>

                <div class="promo-section">
                    <div class="section-title">
                        <i>🎟️</i> Промокод
                    </div>
                    <div class="promo-input">
                        <input type="text" id="promo-code" placeholder="Введите промокод">
                        <button id="apply-promo">Применить</button>
                    </div>
                    <div id="promo-message"></div>
                </div>

                <div class="subscribe-section">
                    <div class="section-title">
                        <i>📢</i> Подписка на канал
                    </div>
                    <p>Подпишитесь на канал <strong>Greatbrawl2imba</strong> и получите 1000 монет!</p>
                    <button class="subscribe-btn" id="subscribe-btn">
                        <i>✓</i> Проверить подписку
                    </button>
                    <div id="subscribe-message"></div>
                </div>
            </div>
        </div>

        <!-- Навигационная панель -->
        <div class="nav-tabs">
            <div class="nav-tab active" data-tab="shop-tab">
                <i>🛒</i>
                <span>Магазин</span>
            </div>
            <div class="nav-tab" data-tab="inventory-tab">
                <i>🎒</i>
                <span>Инвентарь</span>
            </div>
            <div class="nav-tab" data-tab="minigames-tab">
                <i>🎮</i>
                <span>Игры</span>
            </div>
            <div class="nav-tab" data-tab="profile-tab">
                <i>👤</i>
                <span>Профиль</span>
            </div>
        </div>
    </div>

    <!-- Рулетка -->
    <div class="roulette-overlay" id="roulette-overlay">
        <button class="roulette-close" id="roulette-close">✕</button>
        <div class="roulette-container">
            <div class="roulette-center"></div>
            <div class="roulette-items" id="roulette-items">
                <!-- Элементы рулетки будут добавляться здесь -->
            </div>
        </div>
    </div>

    <!-- Модальное окно приза -->
    <div class="modal-overlay" id="prize-modal">
        <div class="modal-content">
            <div class="modal-prize" id="modal-prize-emoji">🎁</div>
            <h2 class="modal-title" id="modal-prize-name">Приз</h2>
            <div class="modal-rarity" id="modal-prize-rarity">Обычный</div>
            <p class="modal-price">Цена продажи: <span id="modal-prize-price">50</span> монет</p>
            <div class="modal-actions">
                <button class="modal-btn modal-btn-sell" id="modal-sell-btn">Продать</button>
                <button class="modal-btn modal-btn-close" id="modal-close-btn">Закрыть</button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Инициализация Telegram Web App
            let tg = window.Telegram.WebApp;
            tg.expand();
            tg.enableClosingConfirmation();
            
            // Эмуляция данных пользователя, если не в Telegram
            let userData = {
                id: tg.initDataUnsafe?.user?.id || 123456789,
                firstName: tg.initDataUnsafe?.user?.first_name || 'Телеграм',
                lastName: tg.initDataUnsafe?.user?.last_name || 'Пользователь',
                avatar: null,
                coins: 1000,
                openedDrops: 0,
                soldItems: 0,
                inventory: [],
                rarestItem: null,
                isSubscribed: false,
                playedGames: { '2048': 0, 'puzzle': 0 }
            };

            // Обновление интерфейса пользователя
            function updateUserInterface() {
                document.getElementById('user-name').textContent = `${userData.firstName} ${userData.lastName}`;
                document.getElementById('user-balance').textContent = `${userData.coins}`;
                document.getElementById('user-avatar').textContent = userData.firstName.charAt(0);
                document.getElementById('stats-opened').textContent = userData.openedDrops;
                document.getElementById('stats-total').textContent = userData.inventory.length;
                document.getElementById('stats-sold').textContent = userData.soldItems;
                document.getElementById('inventory-count').textContent = userData.inventory.length;
                document.getElementById('stats-rarest').textContent = userData.rarestItem ? 
                    `${userData.rarestItem.name} (${getRarityName(userData.rarestItem.rarity)})` : 'Нет';
            }

            // Данные игры
            const items = [
                { id: 1, name: "Роза", emoji: "🌹", rarity: "common", color: "red", price: 50 },
                { id: 2, name: "Кубок", emoji: "🏆", rarity: "rare", color: "gold", price: 100 },
                { id: 3, name: "Сердечко", emoji: "💖", rarity: "common", color: "pink", price: 40 },
                { id: 4, name: "Клевер", emoji: "🍀", rarity: "common", color: "green", price: 45 },
                { id: 5, name: "Луна", emoji: "🌙", rarity: "rare", color: "silver", price: 110 },
                { id: 6, name: "Звезда", emoji: "⭐", rarity: "common", color: "yellow", price: 55 },
                { id: 7, name: "Огненный шар", emoji: "🔥", rarity: "epic", color: "orange", price: 200 },
                { id: 8, name: "Корона", emoji: "👑", rarity: "legendary", color: "gold", price: 500 },
                { id: 9, name: "Ангел", emoji: "👼", rarity: "epic", color: "white", price: 250 },
                { id: 10, name: "Дракон", emoji: "🐉", rarity: "mythical", color: "purple", price: 1000 },
                { id: 11, name: "Книга", emoji: "📖", rarity: "common", color: "brown", price: 60 },
                { id: 12, name: "Щит", emoji: "🛡️", rarity: "rare", color: "steel", price: 120 },
                { id: 13, name: "Меч", emoji: "⚔️", rarity: "epic", color: "silver", price: 220 },
                { id: 14, name: "Кольцо", emoji: "💍", rarity: "legendary", color: "gold", price: 550 },
                { id: 15, name: "Сфера", emoji: "🔮", rarity: "mythical", color: "purple", price: 1100 },
                { id: 16, name: "Часы", emoji: "⌚", rarity: "rare", color: "black", price: 130 },
                { id: 17, name: "Ключ", emoji: "🔑", rarity: "common", color: "bronze", price: 70 },
                { id: 18, name: "Молния", emoji: "⚡", rarity: "epic", color: "yellow", price: 230 },
                { id: 19, name: "Череп", emoji: "💀", rarity: "rare", color: "white", price: 140 },
                { id: 20, name: "Радуга", emoji: "🌈", rarity: "legendary", color: "multicolor", price: 600 },
                { id: 21, name: "Снежинка", emoji: "❄️", rarity: "common", color: "blue", price: 65 },
                { id: 22, name: "Яблоко", emoji: "🍎", rarity: "common", color: "red", price: 45 },
                { id: 23, name: "Сапфир", emoji: "💎", rarity: "epic", color: "blue", price: 270 },
                { id: 24, name: "Феникс", emoji: "🦚", rarity: "mythical", color: "red", price: 1200 },
                { id: 25, name: "Глобус", emoji: "🌎", rarity: "legendary", color: "blue", price: 650 }
            ];

            // Увеличиваем шансы на легендарные и мифические предметы
            const drops = {
                common: { price: 100, chances: { common: 60, rare: 30, epic: 8, legendary: 2, mythical: 0 } },
                rare: { price: 250, chances: { common: 40, rare: 35, epic: 15, legendary: 7, mythical: 3 } },
                epic: { price: 500, chances: { common: 20, rare: 35, epic: 25, legendary: 15, mythical: 5 } },
                legendary: { price: 1000, chances: { common: 5, rare: 20, epic: 30, legendary: 30, mythical: 15 } },
                mythical: { price: 2000, chances: { common: 0, rare: 10, epic: 25, legendary: 35, mythical: 30 } }
            };

            let currentDropType = "common";
            let selectedItem = null;
            let selectedItems = [];

            // Функции для работы с редкостями
            function getRarityName(rarity) {
                const names = {
                    common: "Обычный",
                    rare: "Редкий",
                    epic: "Эпический",
                    legendary: "Легендарный",
                    mythical: "Мифический"
                };
                return names[rarity] || "Неизвестно";
            }

            function getRarityColor(rarity) {
                const colors = {
                    common: "var(--rarity-common)",
                    rare: "var(--rarity-rare)",
                    epic: "var(--rarity-epic)",
                    legendary: "var(--rarity-legendary)",
                    mythical: "var(--rarity-mythical)"
                };
                return colors[rarity] || "gray";
            }

            function getRarityValue(rarity) {
                const values = {
                    common: 1,
                    rare: 2,
                    epic: 3,
                    legendary: 4,
                    mythical: 5
                };
                return values[rarity] || 0;
            }

            function getNextRarity(rarity) {
                const nextRarities = {
                    common: "rare",
                    rare: "epic",
                    epic: "legendary",
                    legendary: "mythical",
                    mythical: "mythical"
                };
                return nextRarities[rarity] || "common";
            }

            // Навигация по вкладкам
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    // Убираем активный класс у всех вкладок
                    document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
                    
                    // Добавляем активный класс к выбранной вкладке
                    this.classList.add('active');
                    document.getElementById(this.dataset.tab).classList.add('active');
                    
                    // Если открываем инвентарь, сбрасываем выбор
                    if (this.dataset.tab === 'inventory-tab') {
                        resetSelection();
                    }
                    
                    // Скрываем игры при переходе на другую вкладку
                    if (this.dataset.tab !== 'minigames-tab') {
                        document.getElementById('game-2048').style.display = 'none';
                        document.getElementById('game-puzzle').style.display = 'none';
                    }
                });
            });

            // Покупка и открытие дропов
            document.querySelectorAll('.buy-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const dropType = this.dataset.type;
                    const dropPrice = drops[dropType].price;
                    
                    if (userData.coins < dropPrice) {
                        alert('Недостаточно монет!');
                        return;
                    }
                    
                    userData.coins -= dropPrice;
                    currentDropType = dropType;
                    
                    // Запускаем анимацию рулетки
                    startRoulette(dropType);
                });
            });

            // Покупка монет за звезды
            document.getElementById('buy-stars-btn').addEventListener('click', function() {
                // В реальном приложении здесь будет вызов Telegram API для оплаты
                // Эмулируем покупку
                if (window.Telegram && window.Telegram.WebApp) {
                    // В реальном приложении:
                    // Telegram.WebApp.openInvoice(url, callback);
                    
                    // Эмуляция успешной оплаты
                    setTimeout(() => {
                        userData.coins += 1000000;
                        updateUserInterface();
                        saveUserData();
                        alert('✅ Успешно! Вы получили 1,000,000 монет!');
                    }, 1000);
                } else {
                    // Для тестирования вне Telegram
                    userData.coins += 1000000;
                    updateUserInterface();
                    saveUserData();
                    alert('✅ Успешно! Вы получили 1,000,000 монет!');
                }
            });

            // Функция запуска рулетки
            function startRoulette(dropType) {
                const rouletteOverlay = document.getElementById('roulette-overlay');
                const rouletteItems = document.getElementById('roulette-items');
                
                // Очищаем предыдущие элементы
                rouletteItems.innerHTML = '';
                
                // Создаем элементы для рулетки (30 элементов)
                for (let i = 0; i < 30; i++) {
                    const item = getRandomPrize(dropType);
                    const rouletteItem = document.createElement('div');
                    rouletteItem.className = 'roulette-item';
                    rouletteItem.innerHTML = item.emoji;
                    rouletteItem.style.color = getRarityColor(item.rarity);
                    rouletteItems.appendChild(rouletteItem);
                }
                
                // Добавляем приз, который действительно выпадет (в середине)
                const realPrize = getRandomPrize(dropType);
                const prizeElement = document.createElement('div');
                prizeElement.className = 'roulette-item';
                prizeElement.innerHTML = realPrize.emoji;
                prizeElement.style.color = getRarityColor(realPrize.rarity);
                prizeElement.dataset.prize = JSON.stringify(realPrize);
                rouletteItems.appendChild(prizeElement);
                
                // Показываем рулетку
                rouletteOverlay.classList.add('active');
                
                // Запускаем анимацию
                setTimeout(() => {
                    const itemsHeight = rouletteItems.scrollHeight;
                    const containerHeight = document.querySelector('.roulette-container').offsetHeight;
                    const targetPosition = itemsHeight - containerHeight / 2 - 40;
                    
                    rouletteItems.style.top = `-${targetPosition}px`;
                    
                    // По завершении анимации показываем приз
                    setTimeout(() => {
                        userData.openedDrops++;
                        userData.inventory.push(realPrize);
                        
                        // Обновляем самую редкую вещь
                        if (!userData.rarestItem || getRarityValue(realPrize.rarity) > getRarityValue(userData.rarestItem.rarity)) {
                            userData.rarestItem = realPrize;
                        }
                        
                        // Обновляем интерфейс
                        updateUserInterface();
                        updateInventory();
                        
                        // Сохраняем данные
                        saveUserData();
                        
                        // Показываем модальное окно с призом
                        setTimeout(() => {
                            rouletteOverlay.classList.remove('active');
                            showPrizeModal(realPrize);
                        }, 1000);
                    }, 5000);
                }, 100);
            }

            // Закрытие рулетки
            document.getElementById('roulette-close').addEventListener('click', function() {
                document.getElementById('roulette-overlay').classList.remove('active');
            });

            // Функция получения случайного приза
            function getRandomPrize(dropType) {
                const chances = drops[dropType].chances;
                const rand = Math.random() * 100;
                
                let rarity;
                if (rand < chances.common) rarity = "common";
                else if (rand < chances.common + chances.rare) rarity = "rare";
                else if (rand < chances.common + chances.rare + chances.epic) rarity = "epic";
                else if (rand < chances.common + chances.rare + chances.epic + chances.legendary) rarity = "legendary";
                else rarity = "mythical";
                
                // Фильтруем предметы по редкости и выбираем случайный
                const availableItems = items.filter(item => item.rarity === rarity);
                const randomItem = availableItems[Math.floor(Math.random() * availableItems.length)];
                
                // Возвращаем копию объекта, чтобы избежать ссылок
                return {...randomItem};
            }

            // Функция показа модального окна с призом
            function showPrizeModal(prize) {
                selectedItem = prize;
                
                document.getElementById('modal-prize-emoji').textContent = prize.emoji;
                document.getElementById('modal-prize-name').textContent = prize.name;
                document.getElementById('modal-prize-rarity').textContent = getRarityName(prize.rarity);
                document.getElementById('modal-prize-rarity').className = `modal-rarity ${prize.rarity}`;
                document.getElementById('modal-prize-price').textContent = prize.price;
                
                document.getElementById('prize-modal').classList.add('active');
            }

            // Закрытие модального окна
            document.getElementById('modal-close-btn').addEventListener('click', function() {
                document.getElementById('prize-modal').classList.remove('active');
                selectedItem = null;
            });

            // Продажа предмета
            document.getElementById('modal-sell-btn').addEventListener('click', function() {
                if (!selectedItem) return;
                
                userData.coins += selectedItem.price;
                userData.soldItems++;
                
                // Удаляем предмет из инвентаря
                const index = userData.inventory.findIndex(item => item.id === selectedItem.id);
                if (index !== -1) {
                    userData.inventory.splice(index, 1);
                }
                
                // Если это была самая редкая вещь, находим новую
                if (userData.rarestItem && userData.rarestItem.id === selectedItem.id) {
                    userData.rarestItem = userData.inventory.reduce((rarest, item) => {
                        if (!rarest || getRarityValue(item.rarity) > getRarityValue(rarest.rarity)) {
                            return item;
                        }
                        return rarest;
                    }, null);
                }
                
                // Обновляем интерфейс
                updateUserInterface();
                updateInventory();
                
                // Закрываем модальное окно
                document.getElementById('prize-modal').classList.remove('active');
                selectedItem = null;
                
                // Сохраняем данные
                saveUserData();
            });

            // Применение промокода
            document.getElementById('apply-promo').addEventListener('click', function() {
                const promoCode = document.getElementById('promo-code').value.trim();
                const promoMessage = document.getElementById('promo-message');
                
                if (promoCode.toLowerCase() === 'sigma') {
                    userData.coins += 200;
                    promoMessage.textContent = 'Промокод применен! +200 монет';
                    promoMessage.style.color = 'var(--success)';
                    
                    // Обновляем интерфейс
                    updateUserInterface();
                    
                    // Сохраняем данные
                    saveUserData();
                } else {
                    promoMessage.textContent = 'Неверный промокод';
                    promoMessage.style.color = 'var(--danger)';
                }
                
                // Очищаем поле ввода
                document.getElementById('promo-code').value = '';
            });

            // Проверка подписки на канал
            document.getElementById('subscribe-btn').addEventListener('click', function() {
                const subscribeMessage = document.getElementById('subscribe-message');
                
                // В реальном приложении здесь будет проверка через Bot API
                // Эмулируем успешную проверку
                if (!userData.isSubscribed) {
                    userData.coins += 1000;
                    userData.isSubscribed = true;
                    subscribeMessage.textContent = '✅ Подписка подтверждена! +1000 монет';
                    subscribeMessage.style.color = 'var(--success)';
                    
                    // Обновляем интерфейс
                    updateUserInterface();
                    
                    // Сохраняем данные
                    saveUserData();
                } else {
                    subscribeMessage.textContent = 'Вы уже получали награду за подписку';
                    subscribeMessage.style.color = 'var(--text-secondary)';
                }
            });

            // Функция обновления инвентаря
            function updateInventory() {
                const inventoryGrid = document.getElementById('inventory-grid');
                inventoryGrid.innerHTML = '';
                
                if (userData.inventory.length === 0) {
                    inventoryGrid.innerHTML = `
                        <div style="grid-column: 1 / -1; text-align: center; padding: 40px 20px; color: var(--text-secondary);">
                            <div style="font-size: 40px; margin-bottom: 16px;">🎁</div>
                            <p>Ваш инвентарь пуст</p>
                            <p>Приобретите дропы в магазине, чтобы получить призы</p>
                        </div>
                    `;
                    return;
                }
                
                userData.inventory.forEach((item, index) => {
                    const itemElement = document.createElement('div');
                    itemElement.className = 'inventory-item';
                    itemElement.style.border = `2px solid ${getRarityColor(item.rarity)}`;
                    itemElement.innerHTML = `
                        <div class="item-image">${item.emoji}</div>
                        <div class="item-info">
                            <div class="item-name">${item.name}</div>
                            <div class="item-rarity ${item.rarity}">${getRarityName(item.rarity)}</div>
                        </div>
                        <button class="sell-btn" data-index="${index}">$</button>
                    `;
                    
                    itemElement.addEventListener('click', (e) => {
                        if (!e.target.classList.contains('sell-btn')) {
                            if (selectedItems.includes(index)) {
                                // Убираем из выбранных
                                selectedItems = selectedItems.filter(i => i !== index);
                                itemElement.classList.remove('selected');
                            } else {
                                // Добавляем в выбранные
                                selectedItems.push(index);
                                itemElement.classList.add('selected');
                            }
                            
                            updateCombineButton();
                        }
                    });
                    
                    // Обработка кнопки продажи
                    const sellBtn = itemElement.querySelector('.sell-btn');
                    sellBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        const itemIndex = parseInt(sellBtn.dataset.index);
                        const itemToSell = userData.inventory[itemIndex];
                        
                        userData.coins += itemToSell.price;
                        userData.soldItems++;
                        
                        // Удаляем предмет из инвентаря
                        userData.inventory.splice(itemIndex, 1);
                        
                        // Если это была самая редкая вещь, находим новую
                        if (userData.rarestItem && userData.rarestItem.id === itemToSell.id) {
                            userData.rarestItem = userData.inventory.reduce((rarest, item) => {
                                if (!rarest || getRarityValue(item.rarity) > getRarityValue(rarest.rarity)) {
                                    return item;
                                }
                                return rarest;
                            }, null);
                        }
                        
                        // Обновляем интерфейс
                        updateUserInterface();
                        updateInventory();
                        
                        // Сохраняем данные
                        saveUserData();
                    });
                    
                    inventoryGrid.appendChild(itemElement);
                });
            }

            // Обновление кнопки объединения
            function updateCombineButton() {
                const combineBtn = document.getElementById('combine-btn');
                if (selectedItems.length >= 5) {
                    combineBtn.disabled = false;
                    combineBtn.style.opacity = '1';
                } else {
                    combineBtn.disabled = true;
                    combineBtn.style.opacity = '0.7';
                }
            }

            // Сброс выбора
            function resetSelection() {
                selectedItems = [];
                document.querySelectorAll('.inventory-item').forEach(item => {
                    item.classList.remove('selected');
                });
                updateCombineButton();
            }

            // Объединение предметов
            document.getElementById('combine-btn').addEventListener('click', function() {
                if (selectedItems.length < 5) return;
                
                // Проверяем, одинаковой ли редкости все предметы
                const firstRarity = userData.inventory[selectedItems[0]].rarity;
                const allSameRarity = selectedItems.every(index => 
                    userData.inventory[index].rarity === firstRarity
                );
                
                if (!allSameRarity) {
                    alert('Для объединения все предметы должны быть одинаковой редкости!');
                    resetSelection();
                    return;
                }
                
                // Получаем следующий уровень редкости
                const nextRarity = getNextRarity(firstRarity);
                
                // Создаем новый предмет
                const availableItems = items.filter(item => item.rarity === nextRarity);
                const newItem = {...availableItems[Math.floor(Math.random() * availableItems.length)]};
                
                // Удаляем старые предметы
                // Сортируем по убыванию, чтобы индексы не сдвигались при удалении
                selectedItems.sort((a, b) => b - a).forEach(index => {
                    userData.inventory.splice(index, 1);
                });
                
                // Добавляем новый предмет
                userData.inventory.push(newItem);
                
                // Обновляем самую редкую вещь
                if (!userData.rarestItem || getRarityValue(newItem.rarity) > getRarityValue(userData.rarestItem.rarity)) {
                    userData.rarestItem = newItem;
                }
                
                // Сбрасываем выбор
                resetSelection();
                
                // Обновляем интерфейс
                updateUserInterface();
                updateInventory();
                
                // Показываем модальное окно с новым предметом
                showPrizeModal(newItem);
                
                // Сохраняем данные
                saveUserData();
            });

            // Мини-игры
            document.querySelectorAll('.play-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const gameType = this.dataset.game;
                    
                    // Скрываем все игры
                    document.querySelectorAll('.minigame-item').forEach(item => {
                        item.style.display = 'none';
                    });
                    
                    // Показываем выбранную игру
                    if (gameType === '2048') {
                        document.getElementById('game-2048').style.display = 'block';
                        init2048Game();
                    } else if (gameType === 'puzzle') {
                        document.getElementById('game-puzzle').style.display = 'block';
                        initPuzzleGame();
                    }
                });
            });

            // Кнопки назад в играх
            document.getElementById('2048-back').addEventListener('click', function() {
                document.getElementById('game-2048').style.display = 'none';
                document.querySelectorAll('.minigame-item').forEach(item => {
                    item.style.display = 'block';
                });
            });

            document.getElementById('puzzle-back').addEventListener('click', function() {
                document.getElementById('game-puzzle').style.display = 'none';
                document.querySelectorAll('.minigame-item').forEach(item => {
                    item.style.display = 'block';
                });
            });

            // Игра 2048
            function init2048Game() {
                const grid = document.getElementById('2048-grid');
                const scoreElement = document.getElementById('2048-score');
                let score = 0;
                let gridState = Array(16).fill(0);
                
                // Очищаем сетку
                grid.innerHTML = '';
                
                // Создаем ячейки
                for (let i = 0; i < 16; i++) {
                    const cell = document.createElement('div');
                    cell.className = 'game-2048-cell';
                    cell.id = `cell-${i}`;
                    grid.appendChild(cell);
                }
                
                // Добавляем начальные плитки
                addRandomTile();
                addRandomTile();
                updateGrid();
                
                // Управление
                document.getElementById('2048-up').addEventListener('click', () => move('up'));
                document.getElementById('2048-down').addEventListener('click', () => move('down'));
                document.getElementById('2048-left').addEventListener('click', () => move('left'));
                document.getElementById('2048-right').addEventListener('click', () => move('right'));
                
                function addRandomTile() {
                    const emptyCells = gridState.reduce((acc, val, idx) => {
                        if (val === 0) acc.push(idx);
                        return acc;
                    }, []);
                    
                    if (emptyCells.length > 0) {
                        const randomIndex = emptyCells[Math.floor(Math.random() * emptyCells.length)];
                        gridState[randomIndex] = Math.random() < 0.9 ? 2 : 4;
                    }
                }
                
                function updateGrid() {
                    for (let i = 0; i < 16; i++) {
                        const cell = document.getElementById(`cell-${i}`);
                        cell.textContent = gridState[i] > 0 ? gridState[i] : '';
                        cell.style.backgroundColor = get2048Color(gridState[i]);
                    }
                    scoreElement.textContent = score;
                }
                
                function get2048Color(value) {
                    const colors = {
                        0: '#3d3d3d',
                        2: '#776e65',
                        4: '#ede0c8',
                        8: '#f2b179',
                        16: '#f59563',
                        32: '#f67c5f',
                        64: '#f65e3b',
                        128: '#edcf72',
                        256: '#edcc61',
                        512: '#edc850',
                        1024: '#edc53f',
                        2048: '#edc22e'
                    };
                    return colors[value] || '#3d3d3d';
                }
                
                function move(direction) {
                    // Упрощенная логика движения для демонстрации
                    let moved = false;
                    
                    // Просто добавляем новую плитку для демонстрации
                    addRandomTile();
                    score += 10;
                    updateGrid();
                    
                    // Проверяем окончание игры (упрощенно)
                    if (gridState.filter(cell => cell === 0).length === 0) {
                        // Начисляем награду
                        const reward = Math.min(500, score);
                        userData.coins += reward;
                        updateUserInterface();
                        saveUserData();
                        alert(`Игра окончена! Вы заработали ${reward} монет.`);
                        document.getElementById('game-2048').style.display = 'none';
                        document.querySelectorAll('.minigame-item').forEach(item => {
                            item.style.display = 'block';
                        });
                    }
                }
            }
            
            // Игра Пазл
            function initPuzzleGame() {
                const grid = document.getElementById('puzzle-grid');
                const movesElement = document.getElementById('puzzle-moves');
                let moves = 0;
                let puzzleState = [1, 2, 3, 4, 5, 6, 7, 8, 0]; // 0 - пустая клетка
                
                // Очищаем сетку
                grid.innerHTML = '';
                
                // Перемешиваем пазл
                shufflePuzzle();
                
                // Создаем ячейки
                for (let i = 0; i < 9; i++) {
                    const piece = document.createElement('div');
                    piece.className = puzzleState[i] === 0 ? 'puzzle-piece empty' : 'puzzle-piece';
                    piece.textContent = puzzleState[i] === 0 ? '' : puzzleState[i];
                    piece.dataset.index = i;
                    piece.addEventListener('click', handlePuzzleClick);
                    grid.appendChild(piece);
                }
                
                movesElement.textContent = moves;
                
                function shufflePuzzle() {
                    // Упрощенная перемешка для демонстрации
                    for (let i = 0; i < 100; i++) {
                        const emptyIndex = puzzleState.indexOf(0);
                        const possibleMoves = [];
                        
                        if (emptyIndex % 3 !== 0) possibleMoves.push(emptyIndex - 1); // left
                        if (emptyIndex % 3 !== 2) possibleMoves.push(emptyIndex + 1); // right
                        if (emptyIndex >= 3) possibleMoves.push(emptyIndex - 3); // up
                        if (emptyIndex < 6) possibleMoves.push(emptyIndex + 3); // down
                        
                        const randomMove = possibleMoves[Math.floor(Math.random() * possibleMoves.length)];
                        
                        // Меняем местами
                        puzzleState[emptyIndex] = puzzleState[randomMove];
                        puzzleState[randomMove] = 0;
                    }
                }
                
                function handlePuzzleClick(e) {
                    const clickedIndex = parseInt(e.target.dataset.index);
                    const emptyIndex = puzzleState.indexOf(0);
                    
                    // Проверяем, можно ли移動
                    if (isAdjacent(clickedIndex, emptyIndex)) {
                        // Меняем местами
                        puzzleState[emptyIndex] = puzzleState[clickedIndex];
                        puzzleState[clickedIndex] = 0;
                        
                        moves++;
                        movesElement.textContent = moves;
                        
                        // Обновляем отображение
                        updatePuzzleView();
                        
                        // Проверяем решение
                        if (isPuzzleSolved()) {
                            // Начисляем награду
                            const reward = Math.max(100, 300 - moves * 10);
                            userData.coins += reward;
                            updateUserInterface();
                            saveUserData();
                            alert(`Пазл решен! Вы заработали ${reward} монет.`);
                            document.getElementById('game-puzzle').style.display = 'none';
                            document.querySelectorAll('.minigame-item').forEach(item => {
                                item.style.display = 'block';
                            });
                        }
                    }
                }
                
                function isAdjacent(a, b) {
                    return (
                        (a === b - 1 && a % 3 !== 2) || // right
                        (a === b + 1 && a % 3 !== 0) || // left
                        a === b - 3 || // down
                        a === b + 3    // up
                    );
                }
                
                function updatePuzzleView() {
                    const pieces = grid.querySelectorAll('.puzzle-piece');
                    pieces.forEach((piece, index) => {
                        const value = puzzleState[index];
                        piece.textContent = value === 0 ? '' : value;
                        piece.className = value === 0 ? 'puzzle-piece empty' : 'puzzle-piece';
                    });
                }
                
                function isPuzzleSolved() {
                    for (let i = 0; i < 8; i++) {
                        if (puzzleState[i] !== i + 1) return false;
                    }
                    return puzzleState[8] === 0;
                }
            }

            // Функция сохранения данных пользователя
            function saveUserData() {
                localStorage.setItem('bahraz_userData', JSON.stringify(userData));
            }

            // Функция загрузки данных пользователя
            function loadUserData() {
                const savedData = localStorage.getItem('bahraz_userData');
                if (savedData) {
                    userData = JSON.parse(savedData);
                }
                updateUserInterface();
                updateInventory();
            }

            // Загружаем данные при запуске
            loadUserData();
        });
    </script>
</body>
                                                                                      </html>
